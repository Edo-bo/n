<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>DATABASE BY OWNER</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: black;
      background-image: url('https://storage.googleapis.com/a1aa/image/51269bfa-4829-45ff-0c20-0e124a5395f8.jpg');
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    #numberList::-webkit-scrollbar {
      width: 8px;
    }
    #numberList::-webkit-scrollbar-thumb {
      background-color: #818cf8; /* indigo-400 */
      border-radius: 4px;
    }
    #numberList::-webkit-scrollbar-track {
      background: transparent;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-8">
  <main class="bg-white/90 shadow-2xl rounded-3xl max-w-3xl w-full p-6 sm:p-10 backdrop-blur-md border border-indigo-300">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-indigo-700 text-center mb-10 select-none leading-tight">
      ðŸ”¥ SIMPLE BOT V18 NEWðŸ”¥
    </h1>
    <h1 class="text-3xl sm:text-4xl font-extrabold text-indigo-700 text-center mb-10 select-none leading-tight">
       ADD AKSES DI SINI 
    </h1>

    <div class="flex flex-col sm:flex-row gap-4 mb-8">
      <input
        type="text"
        id="newNumber"
        placeholder="Masukkan nomor baru (mis: 628123456789)"
        inputmode="numeric"
        pattern="[0-9]+"
        autocomplete="off"
        aria-label="Masukkan nomor baru"
        class="flex-grow px-5 py-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-indigo-400 text-lg sm:text-xl shadow-sm transition"
      />
      <button
        type="button"
        onclick="addNumber()"
        class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl px-8 py-4 transition-colors duration-300 flex items-center justify-center text-lg sm:text-xl shadow-lg shadow-indigo-500/50"
        aria-label="Tambah nomor"
      >
        <i class="fas fa-plus mr-3"></i> Tambah
      </button>
    </div>

    <section class="mb-10">
      <h2 class="text-xl sm:text-2xl font-semibold text-gray-900 mb-4 border-b-2 border-indigo-400 pb-2">
        Daftar Nomor 
      </h2>
      <ul
        id="numberList"
        class="max-h-72 sm:max-h-96 overflow-y-auto border border-gray-300 rounded-xl divide-y divide-gray-300 bg-indigo-50 shadow-inner"
        aria-live="polite"
        aria-relevant="additions removals"
      >
      </ul>
    </section>

    <section>
      <h2 class="text-xl sm:text-2xl font-semibold text-gray-900 mb-6 border-b-2 border-green-500 pb-2">
        Pengaturan Database
      </h2>
      <form onsubmit="event.preventDefault()" class="space-y-6">
        <input
          type="text"
          id="token"
          placeholder="GitHub Personal Access Token"
          autocomplete="off"
          aria-label="GitHub Personal Access Token"
          class="w-full px-5 py-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-green-400 text-lg sm:text-xl shadow-sm transition"
        />
        <input
          type="text"
          id="owner"
          placeholder="GitHub Owner (mis: Edo-bo)"
          autocomplete="off"
          aria-label="GitHub Owner"
          class="w-full px-5 py-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-green-400 text-lg sm:text-xl shadow-sm transition"
        />
        <input
          type="text"
          id="repo"
          placeholder="Nama Repo (mis: database)"
          autocomplete="off"
          aria-label="Nama Repo"
          class="w-full px-5 py-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-green-400 text-lg sm:text-xl shadow-sm transition"
        />
        <input
          type="text"
          id="path"
          placeholder="Path File (mis: database.json)"
          autocomplete="off"
          aria-label="Path File"
          class="w-full px-5 py-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-green-400 text-lg sm:text-xl shadow-sm transition"
        />
        <button
          type="button"
          onclick="commitChanges()"
          class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-4 rounded-xl transition-colors duration-300 flex items-center justify-center text-lg sm:text-xl shadow-lg shadow-green-500/50"
          aria-label="Simpan ke GitHub"
        >
          <i class="fas fa-save mr-3"></i> Simpan ke Database
        </button>
      </form>
    </section>
  </main>

  <script>
    let database = [];
    const rawUrl = 'https://raw.githubusercontent.com/Edo-bo/database/main/database.json';

    async function fetchDatabase() {
      try {
        const res = await fetch(rawUrl);
        if (!res.ok) throw new Error('Failed to fetch database');
        database = await res.json();
        renderList();
      } catch (e) {
        database = [];
        renderList();
        alert('Gagal memuat database, mulai dengan daftar kosong.');
      }
    }

    function renderList() {
      const list = document.getElementById('numberList');
      list.innerHTML = '';
      if (database.length === 0) {
        const emptyMsg = document.createElement('li');
        emptyMsg.className = 'text-center text-gray-500 py-8 italic select-none text-lg sm:text-xl';
        emptyMsg.textContent = 'Belum ada nomor dalam database.';
        list.appendChild(emptyMsg);
        return;
      }
      database.forEach((number, index) => {
        const li = document.createElement('li');
        li.className = 'flex justify-between items-center py-4 px-6 hover:bg-indigo-100 transition-colors rounded-xl mx-3 my-2 shadow-sm';

        const span = document.createElement('span');
        span.className = 'text-indigo-900 font-semibold break-all select-text text-lg sm:text-xl';
        span.textContent = number;

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'text-red-600 hover:text-red-800 transition-colors duration-150 p-3 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400 shadow-md';
        btn.setAttribute('aria-label', `Hapus nomor ${number}`);
        btn.innerHTML = '<i class="fas fa-trash-alt"></i>';
        btn.onclick = () => removeNumber(index);

        li.appendChild(span);
        li.appendChild(btn);
        list.appendChild(li);
      });
    }

    function addNumber() {
      const input = document.getElementById('newNumber');
      const value = input.value.trim();
      if (!value) {
        alert('Masukkan nomor terlebih dahulu.');
        return;
      }
      if (!/^\d+$/.test(value)) {
        alert('Nomor hanya boleh berisi angka.');
        return;
      }
      if (database.includes(value)) {
        alert('Nomor sudah ada di database.');
        return;
      }
      database.push(value);
      renderList();
      input.value = '';
      alert('Nomor ditambahkan secara lokal. Klik "Simpan ke Database" untuk commit.');
    }

    function removeNumber(index) {
      if (confirm('Yakin ingin menghapus nomor ini?')) {
        database.splice(index, 1);
        renderList();
        alert('Nomor dihapus secara lokal. Klik "Simpan ke Database" untuk commit.');
      }
    }

    async function commitChanges() {
      const token = document.getElementById('token').value.trim();
      const owner = document.getElementById('owner').value.trim();
      const repo = document.getElementById('repo').value.trim();
      const path = document.getElementById('path').value.trim();

      if (!token || !owner || !repo || !path) {
        alert('Semua pengaturan GitHub harus diisi.');
        return;
      }

      const getUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;

      try {
        const getRes = await fetch(getUrl, {
          headers: { Authorization: `token ${token}` }
        });
        if (!getRes.ok) {
          const err = await getRes.json();
          throw new Error(err.message || 'Gagal mengambil file dari database.json');
        }
        const fileData = await getRes.json();

        const content = btoa(unescape(encodeURIComponent(JSON.stringify(database, null, 2))));

        const res = await fetch(getUrl, {
          method: 'PUT',
          headers: {
            Authorization: `token ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'Update database.json via owner',
            content: content,
            sha: fileData.sha
          })
        });

        if (res.ok) {
          alert('Perubahan berhasil dikirim ke Database!');
        } else {
          const error = await res.json();
          alert('Gagal menyimpan: ' + (error.message || 'Unknown error'));
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    fetchDatabase();
  </script>
</body>
</html>
