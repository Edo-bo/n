<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Nomor Database</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: url('https://i.supa.codes/s4-yNP') no-repeat center center fixed;
      background-size: cover;
    }
    #numberList::-webkit-scrollbar {
      width: 6px;
    }
    #numberList::-webkit-scrollbar-thumb {
      background-color: #a5b4fc;
      border-radius: 3px;
    }
    #numberList::-webkit-scrollbar-track {
      background: transparent;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <main class="bg-white shadow-lg rounded-xl max-w-xl w-full p-6 sm:p-8">
    <h1 class="text-2xl sm:text-3xl font-extrabold text-indigo-700 text-center mb-8 select-none">
      ðŸ”¥ ADD USER SIMPLE BOT V18 ðŸ”¥
    </h1>

    <div class="flex flex-col sm:flex-row gap-3 mb-6">
      <input type="text" id="newNumber" placeholder="Masukkan nomor baru (mis: 628123456789)" inputmode="numeric"
        pattern="[0-9]+" autocomplete="off" aria-label="Masukkan nomor baru"
        class="flex-grow px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-base sm:text-lg" />
      <button type="button" onclick="addNumber()"
        class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg px-6 py-3 transition-colors duration-200 flex items-center justify-center text-base sm:text-lg"
        aria-label="Tambah nomor">
        <i class="fas fa-plus mr-2"></i> Tambah
      </button>
    </div>

    <section class="mb-8">
      <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-3 border-b border-indigo-300 pb-1">
        Daftar Nomor
      </h2>
      <ul id="numberList"
        class="max-h-64 overflow-y-auto border border-gray-200 rounded-lg divide-y divide-gray-200 bg-indigo-50"
        aria-live="polite" aria-relevant="additions removals">
      </ul>
    </section>

    <section>
      <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-4 border-b border-green-400 pb-1">
        Pengaturan GitHub
      </h2>
      <form onsubmit="event.preventDefault()" class="space-y-4">
        <input type="text" id="token" placeholder="GitHub Personal Access Token" autocomplete="off"
          aria-label="GitHub Personal Access Token"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 text-base sm:text-lg" />
        <input type="text" id="owner" placeholder="GitHub Owner (mis: Edo-bo)" autocomplete="off"
          aria-label="GitHub Owner"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 text-base sm:text-lg" />
        <input type="text" id="repo" placeholder="Nama Repo (mis: database)" autocomplete="off" aria-label="Nama Repo"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 text-base sm:text-lg" />
        <input type="text" id="path" placeholder="Path File (mis: database.json)" autocomplete="off"
          aria-label="Path File"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 text-base sm:text-lg" />
        <button type="button" onclick="commitChanges()"
          class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition-colors duration-200 flex items-center justify-center text-base sm:text-lg"
          aria-label="Simpan ke GitHub">
          <i class="fas fa-save mr-2"></i> Simpan ke GitHub
        </button>
      </form>
    </section>
  </main>

  <script>
    let database = [];
    const rawUrl = 'https://raw.githubusercontent.com/Edo-bo/database/main/database.json';

    async function fetchDatabase() {
      try {
        const res = await fetch(rawUrl);
        if (!res.ok) throw new Error('Failed to fetch database');
        database = await res.json();
        renderList();
      } catch (e) {
        database = [];
        renderList();
        alert('Gagal memuat database, mulai dengan daftar kosong.');
      }
    }

    function renderList() {
      const list = document.getElementById('numberList');
      list.innerHTML = '';
      if (database.length === 0) {
        const emptyMsg = document.createElement('li');
        emptyMsg.className = 'text-center text-gray-400 py-6 italic select-none';
        emptyMsg.textContent = 'Belum ada nomor dalam database.';
        list.appendChild(emptyMsg);
        return;
      }
      database.forEach((number, index) => {
        const li = document.createElement('li');
        li.className = 'flex justify-between items-center py-3 px-4 hover:bg-indigo-100 transition-colors rounded-lg mx-2 my-1';

        const span = document.createElement('span');
        span.className = 'text-indigo-900 font-medium break-all select-text text-base sm:text-lg';
        span.textContent = number;

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'text-red-600 hover:text-red-800 transition-colors duration-150 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400';
        btn.setAttribute('aria-label', `Hapus nomor ${number}`);
        btn.innerHTML = '<i class="fas fa-trash-alt"></i>';
        btn.onclick = () => removeNumber(index);

        li.appendChild(span);
        li.appendChild(btn);
        list.appendChild(li);
      });
    }

    function addNumber() {
      const input = document.getElementById('newNumber');
      const value = input.value.trim();
      if (!value) {
        alert('Masukkan nomor terlebih dahulu.');
        return;
      }
      if (!/^\d+$/.test(value)) {
        alert('Nomor hanya boleh berisi angka.');
        return;
      }
      if (database.includes(value)) {
        alert('Nomor sudah ada di database.');
        return;
      }
      database.push(value);
      renderList();
      input.value = '';
      alert('Nomor ditambahkan secara lokal. Klik "Simpan ke GitHub" untuk commit.');
    }

    function removeNumber(index) {
      if (confirm('Yakin ingin menghapus nomor ini?')) {
        database.splice(index, 1);
        renderList();
        alert('Nomor dihapus secara lokal. Klik "Simpan ke GitHub" untuk commit.');
      }
    }

    async function commitChanges() {
      const token = document.getElementById('token').value.trim();
      const owner = document.getElementById('owner').value.trim();
      const repo = document.getElementById('repo').value.trim();
      const path = document.getElementById('path').value.trim();

      if (!token || !owner || !repo || !path) {
        alert('Semua pengaturan GitHub harus diisi.');
        return;
      }

      const getUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;

      try {
        const getRes = await fetch(getUrl, {
          headers: { Authorization: `token ${token}` }
        });
        if (!getRes.ok) {
          const err = await getRes.json();
          throw new Error(err.message || 'Gagal mengambil file dari GitHub');
        }
        const fileData = await getRes.json();

        const content = btoa(unescape(encodeURIComponent(JSON.stringify(database, null, 2))));

        const res = await fetch(getUrl, {
          method: 'PUT',
          headers: {
            Authorization: `token ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'Update database.json via owner',
            content: content,
            sha: fileData.sha
          })
        });

        if (res.ok) {
          alert('Perubahan berhasil dikirim ke Database!');
        } else {
          const error = await res.json();
          alert('Gagal menyimpan: ' + (error.message || 'Unknown error'));
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    fetchDatabase();
  </script>
</body>
</html>
